/**
 * This modules could parse node command line arguments to what you want to get.
 * 
 * How to use:
 *  require('path/to/parse-commandline-arguments').parseCommandlineArguments(process.argv, {only: ''})
 * 
 * This will search in the command line arguments to find input named as --only. If found it with value
 *  it will return {only: 'value'}, if found it wihtout value, it will returen {only: ture}. But if 
 *  cannot find it, it will return {only: false}
 * 
 * To run test:
 *  node ./ test-mode
 * Then you will see the test output.
 * 
 * todo: format test output
 */


var hasRunTest = false;
process.argv.forEach(function (val, index, array) {
    if (val === 'test-mode') {
        if (!hasRunTest) {
            test();            
        }
    }
});

exports.parseCommandlineArguments = parseCommandlineArguments;

function parseCommandlineArguments(args, config) {
    var res = {};
    for (var key in config) {
        if (config.hasOwnProperty(key)) {
            var value = getArgumenValuetByName(args, key);
            res[key] = value ? value : config[key];
        }
    }
    return res;
}

function getArgumenValuetByName(args, name) {
    var res = null;
    for (var i = 0; i < args.length; i++) {
        if (args[i] === ('--' + name)) {
            i++;
            if (!args[i] || args[i].startsWith('--')) {
                res = true;
            } else if (args[i]) {
                res = args[i];
            }
        }
    }
    return res;
}

function test() {
    hasRunTest = true;

    var config = {
        target: '',
        baseurl: '',
    };

    var args = [
        '--target',
        'test',
        '--baseurl',
        'test.abacus.co'
    ];

    console.log(parseCommandlineArguments(args, config));
    console.log("should be ", { target: 'test', baseurl: 'test.abacus.co' });

    config = {
        target: '',
        baseurl: '',
    };

    args = [
        '--target',
        '--baseurl',
        'test.abacus.co'
    ];

    console.log(parseCommandlineArguments(args, config));
    console.log("Should be ", { target: true, baseurl: 'test.abacus.co' });
    
    config = {
        target: '',
        baseurl: '',
    };

    args = [
        '--target',
        'test',
        '--baseurl'
    ];

    console.log(parseCommandlineArguments(args, config));
    console.log("Should be ", { target: 'test', baseurl: true });

    config = {
        target: false,
        baseurl: '',
    };

    args = [
        '--baseurl'
    ];

    console.log(parseCommandlineArguments(args, config));
    console.log("should be ", { target: false, baseurl: true });
}